<p>[iTC_CC_ATP-SwRS-0194]
当读到线路地图中与之前MTIB1匹配的MTIB2时，根据经过的齿数值，在ATPsetting中查表得到最大最小齿距，并比较测得的齿距结果：
如果测得的最大最小齿距在理论值范围内，则齿距校准状态从CALI_MEASURING到CALI_VALIDATING；
如果在理论范围外，则状态从CALI_MEASURING转入CALI_WAITING。
If ATP is in the state of CALI_MEASURING and following conditions fulfilled:
a valid beacon has been received and the beacon and first memorized calibration beacon is one of possible dedicated couple of calibration,
and train kinematic was valid,
and no excessive slip/slide effect was detected,
and sign of train motion is still identical to thus detected on first beacon signaling,
Then,
if resulting calibration range is included in default calibration range, then ATP shall:
memorize:
position of the wheel before and after top location signal of received beacon,
the id of received beacon,
and shall consider itself as CALI_VALIDATING.
else: ATP shall consider that calibration process has failed and back to CALI_WAITING.</p>
<pre><code>	if ((CalibrationState(k-1) == CALI_MEASURING)
	     and (NewBeaconObtained(k) == True)
	     and (TrackMap.AreNeighbouredBeacons(BeaconMessage.Id(k),
	                                                CalibrationMeasurementStartBeacon(k)) == True)
	     and (SlipSlideDetected(k) == False)
	     and (CalibrationEnd1RunningForward(k-1) == End1RunningForward(k)))
	    if ((ATPsetting.OdoCaliDefaultCogLengthMax &gt;= MaxCogCalibrationMeasured)
	        and (ATPsetting.OdoCaliDefaultCogLengthMin &lt;= MinCogCalibrationMeasured))
	         CalibrationValidationStartPositionMin = CogPositionBeforeTopLoc(k)
	         CalibrationValidationStartPositionMax = CogPositionAfterTopLoc(k)
	         CalibrationValidationStartBeacon = BeaconMessage.Id(k))
	         CalibrationResultMin = M
	inCogCalibrationMeasured         CalibrationResultMax = M
	axCogCalibrationMeasured         CalibrationState =  CALI_VALIDATING
	    else:
	         CalibrationState = CALI_WAITING
</code></pre>
<p>其中最大最小测得齿距是根据校准过程中测得齿数，在离线工具计算的齿数-齿距对照表中查到的：
Among them, the measured maximum and minimum calibration fetches from the offline-generated counter-calibration table, based on the calculated cog counter.</p>
<pre><code>	MinCogCalibrationMeasured
	 = CaliMinRatio * ATPsetting.MeterCaliMaxMinCalibration[1]
	[|CalibrationMeasurementStartPositionMin(k)-CogPositionAfterTopLoc(k)|
	 - ATPsetting.OdoCaliCogCounterMin]
	MaxCogCalibrationMeasured
	 = CaliMaxRatio * ATPsetting.MeterCaliMaxMinCalibration[0]
	[|CalibrationMeasurementStartPositionMax(k)-CogPositionBeforeTopLoc(k)|
	 - ATPsetting.OdoCaliCogCounterMin]
</code></pre>
<p>其中CaliMinRatio和CaliMaxRatio是离线工具计算的该校准信标所对应的MTIB结构的相关属性，表示该对MTIB的间距与标准间距（21米）的比率，该结构定义见[REF11]。
The CaliMinRation and CaliMaxRation are elements of structure MTIB generated by offline tool for each couple of calibration beacons. Refer to [REF11] for the definition of MTIB.
#Category=Functional
#Contribution=SIL4
#Allocation=ATP Software, Vital Embedded Setting
#Source=[iTC_CC-SyAD-0132], [iTC_CC-SyAD-0143], [iTC_CC-SyAD-0144], [iTC_CC-SyAD-0145], [iTC_CC-SyAD-0183], [iTC_CC_ATP_SwHA-0068]
[End]
[iTC_CC_ATP-SwRS-0195]
如果校准过程中发生下列情况，则从CALI_MEASURING回到CALI_WAITING
If ATP is in the state of CALI_MEASURING and following conditions fulfilled:
train kinematic has been detected not valid,
or excessive slip/slide effect has been detected,
or WheelMinimumMovement sign is in the opposite direction of thus observed on first beacon or becomes null,
or an unexpected beacon has been received. That is, a beacon not belonging calibration measurement couple.
Then, ATP shall abort calibration process and back to CALI_WAITING.</p>
<pre><code>	if ((CalibrationState(k-1) =  CALI_MEASURING)
	     and ((ValidTrainKinematic(k) == False)
	          or (OdometerState(k) is INVALID)
	          or (SlipSlideDetected(k) == True)
	          or (CalibrationEnd1RunningForward(k-1) != End1RunningForward(k))
	          or (TrainFilteredStopped(k) == True)
	          or ((NewBeaconObtained(k) == True)
	              and TrackMap.BeaconBelongsToCalibrationCouple(BeaconMessage.Id(k)) == False)))
	    CalibrationState = CALI_WAITING
</code></pre>
<p>#Category=Functional
#Contribution=SIL4
#Allocation=ATP Software, Vital Embedded Setting
#Source=[iTC_CC-SyAD-0145], [iTC_CC-SyAD-0183]
[End]</p>
