
ATP软件适用于不同的工程项目，对于项目相关的配置参数和线路地图等信息，须由离线工具生成，并存储在VLE-2板指定存储空间。ATP软件在上电后通过读取配置参数和线路地图来获取当前项目信息，根据配置项执行相关功能。ATP软件应当通过校验来保证配置参数和线路地图是正确的。对于相同类型的列车，冗余ATP和不同CPU模块之间的ATP所使用的配置参数和线路地图也应当是相同的。
ATP software should apply to different projects. For project-related configuration parameters, track maps and other information, generated by CC offline tool, are stored in the VLE-2 board designated storage space. When power on, the ATP software shall read these configurations and perform for related functions. Before using, the ATP shall verify the correctness of these parameters and track maps, and shall ensure the consistency of these data with the other CPU module and with the redundant ATP on the other END of train.
[iTC_CC_ATP-SwRS-0057]
根据TrainType类型，车载ATP读取相对应由离线工具生成的带VCP编码的ATP项目配置参数DATA.VES，并进行校验，如果校验正确则生成车载ATP配置数据ATPsetting，其结构如Table 61所示；若校验错误则ATP将不继续运行。
According with train type, ATP software shall compute the VCP check words of the project vital setting DATA.VES, which generated by CC offline tools.
If check words are correct, ATP software shall read the vital setting and convert to the global variable ATPsetting according to the Table 61;
Otherwise, the ATP shall cease to run.
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software, Vital Embedded Setting
\#Source=[iTC_CC-SyAD-0332], [iTC_CC-SyAD-0385], [iTC_CC_ATP_SwHA-0011], [iTC_CC_ATP-Offline-SyID-0001], [iTC_CC_ATP-Offline-SyID-0002], [iTC_CC_ATP-Offline-SyID-0003], [iTC_CC_ATP-Offline-SyID-0004], [iTC_CC_ATP-Offline-SyID-0009], [iTC_CC-SyAD-0032]
[End]
[iTC_CC_ATP-SwRS-0058]
根据TrainType类型，车载ATP读取由离线工具生成的带VCP编码的线路地图数据DATA.VES，并进行校验，如果校验正确则生成TrackMap，其结构见[REF11]定义；如果校验错误，则ATP将不继续运行。
According with train type, ATP software shall read DATA.VES and detect the track map data with VCP which was generated by CC offline tools. If the data is correct, ATP shall generate TrackMap with the structure as refer to [REF11]; Otherwise, ATP cannot continue to operate.
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software, Vital Embedded Setting
\#Source=[iTC_CC-SyAD-0332], [iTC_CC-SyAD-0385], [iTC_CC_ATP_SwHA-0174], [iTC_CC_ATP-Offline-SyID-0001], [iTC_CC_ATP-Offline-SyID-0002], [iTC_CC_ATP-Offline-SyID-0003], [iTC_CC_ATP-Offline-SyID-0005], [iTC_CC_ATP-Offline-SyID-0009], [iTC_CC-SyAD-0032]
[End]
[iTC_CC_ATP-SwRS-0755]
DATA.VES中部分与输入输出相关功能的代码，由离线工具根据项目安全配置数据生成，带有VCP编码，ATP在初始化时读取使用，生成Offline结构如Table 63所示，详见[REF11]。
Some parts of codes in DATA.VES, related to input and output functions, as project configuration data, ATP links them during initialization and generates Offline structure as Table 63, refer to [REF11].
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software, Vital Embedded Setting
\#Source=[iTC_CC-SyAD-0332], [iTC_CC-SyAD-0385], [iTC_CC-SyAD-0032], [iTC_CC_ATP_SwHA-0174], [iTC_CC_ATP_SwHA-0189], [iTC_CC_ATP_SwHA-0190], [iTC_CC_ATP_SwHA-0200], [iTC_CC_ATP_SwHA-0201], [iTC_CC_ATP_SwHA-0202], [iTC_CC_ATP_SwHA-0203], [iTC_CC_ATP_SwHA-0205], [iTC_CC_ATP_SwHA-0208], [iTC_CC_ATP_SwHA-0233], [iTC_CC_ATP_SwHA-0253], [iTC_CC_ATP_SwHA-0265], [iTC_CC_ATP_SwHA-0268], [iTC_CC_ATP_SwHA-0269], [iTC_CC_ATP-Offline-SyID-0001], [iTC_CC_ATP-Offline-SyID-0002], [iTC_CC_ATP-Offline-SyID-0003], [iTC_CC_ATP-Offline-SyID-0006], [iTC_CC_ATP-Offline-SyID-0007], [iTC_CC_ATP-Offline-SyID-0008], [iTC_CC_ATP-Offline-SyID-0009]
[End]
NOTE：
对于离线工具生成的项目配置参数和线路地图，如果在车载ATP软件读取发生错误，或者在运行过程中该配置的值发生了改变，则会使得VCP编码计算错误，从而导致VIOM输出为限制状态，导向安全。
For the configuration parameters and track map, generated by the CC offline tool, if there is error for the ATP reading, or there is any changes during the processing, the VCP coding calculation will be conducted the wrong data, which will causing the VIOM output is set as restricted status. 
[iTC_CC_ATP-SwRS-0536]
SafeApplicationVersion，ATP软件的版本号。ATP软件应当在代码中定义软件的版本号，每次修改代码时，更新该版本号。
SafeApplicationVersion stands for the version of ATP software. The version of ATP software is defined in source code. The version shall be update whenever the code changed.
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software
\#Source=[iTC_CC-SyAD-0388]
[End]
[iTC_CC_ATP-SwRS-0537]
IdenticalVersionOfDualCPU，ATP软件在获取了data plug和离线数参数及线路地图后，需与另一个模块进行比较，如果下列内容全都一致，则设置IdenticalVersionOfDualCPU为True；否则如果任意一项不相同，则设置IdenticalVersionOfDualCPU为False。
TrainType，来自data plug的列车类型；
CoreId，来自data plug的所在车头标识；
SubSystemId，来自data plug的列车标识；
TrackMap，线路地图中相应每个ZC区的版本号；
ATPsetting，配置数据的版本号；
SafeApplicationVersion，ATP软件版本号。
After ATP gets the offline parameters and track map from the CC data plug, it needs to compare this information with the other CPU module, which represented by the term of IdenticalVersionOfDualCPU. If the information is as same, ATP shall set IdenticalVersionOfDualCPU as True; otherwise, it will set IdenticalVersionOfDualCPU as False. 
TrainType, the train type from data plug;
CoreId, the train end identification from data plug;
SubSystemId, the train identification from data plug;
TrackMap, the version number of each ZC region in line map;
ATPsetting, the version number for the configuration data;
SafeApplicationVersion, the version of ATP software.
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software
\#Source=[iTC_CC-SyAD-0388], [iTC_CC_ATP_SwHA-0173], [iTC_CC-SyAD-0032]
[End]
[iTC_CC_ATP-SwRS-0059]
上述信息均获取正确并且相一致后，生成TrainKnown信息。如果TrainKnown为False，则VIOM将输出全限制状态。
After all above-mentioned information has corrected, and correspondingly, ATP will generate TrainKnown information. If TrainKnown considered as False, ATP shall set all output ports as restricted.
```
	def TrainKnown(k):
	    return ((TrainType(k) == ATPsetting.TrainTypeId)
	            and (CoreId(k) is END_1
	                 or CoreId(k) is END_2)
	            and IdenticalVersionOfDualCPU(k))
```
\#Category=Functional
\#Contribution=SIL4
\#Allocation=ATP Software, Vital Embedded Setting
\#Source=[iTC_CC-SyAD-0332], [iTC_CC-SyAD-0333], [iTC_CC-SyAD-0372], [iTC_CC_ATP_SwHA-0006], [iTC_CC_ATP_SwHA-0007], [iTC_CC-SyAD-0032]
[End]
